<!doctype html><html lang=zh-cn dir=auto class=han-init>
<head>
<meta name=generator content="Hugo 0.91.2"><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>RAMBLE&BB</title>
<meta name=description content>
<meta name=author content>
<link rel=canonical href=https://blog.black-desk.cn/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.1953d0aedd677e6a027d5ea145d2e71a2b2101649fba37784de1035cf38994a3.css integrity="sha256-GVPQrt1nfmoCfV6hRdLnGishAWSfujd4TeEDXPOJlKM=" rel="preload stylesheet" as=style>
<link rel=icon href=https://blog.black-desk.cn/favicon.ico>
<link rel=apple-touch-icon href=https://blog.black-desk.cn/apple-touch-icon.png>
<link rel=alternate type=application/rss+xml href=https://blog.black-desk.cn/index.xml>
<meta name=twitter:title content="RAMBLE&BB">
<meta name=twitter:description content>
<meta name=twitter:site content="@novoreorx">
<meta name=twitter:creator content="@novoreorx">
<meta property="og:title" content="RAMBLE&BB">
<meta property="og:description" content>
<meta property="og:type" content="website">
<meta property="og:url" content="https://blog.black-desk.cn/">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"RAMBLE\u0026BB","url":"https://blog.black-desk.cn","description":"","thumbnailUrl":"https://blog.black-desk.cn/favicon.ico","sameAs":[]}</script><link rel=stylesheet media=all href=https://cdnjs.cloudflare.com/ajax/libs/Han/3.3.0/han.min.css>
<link rel=stylesheet media=all href=/pandoc_hl.css>
<style>.uri:only-child{display:inline-block;width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}input[type=checkbox]{margin-right:.2em;margin-left:-1.7em;width:1.5em}</style>
<script src=https://code.jquery.com/jquery-3.6.0.slim.min.js></script>
<script>$(document).ready(()=>{$(".uri:only-child").each(function(){(this.nextSibling&&this.nextSibling.nodeValue&&this.nextSibling.nodeValue.trim()||this.previousSibling&&this.previousSibling.nodeValue&&this.previousSibling.nodeValue.trim())&&$(this).css("display","inline").css("white-space","break-spaces")})})</script>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
</head>
<body class=list id=top><script data-no-instant>function switchTheme(a){switch(a){case'light':document.body.classList.remove('dark');break;case'dark':document.body.classList.add('dark');break;default:window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(a){switchTheme(a),localStorage.setItem("pref-theme",a)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=a=>{a?setPrefTheme('light'):setPrefTheme('dark')},window.addEventListener('toggle-theme',function(){const a=isDarkTheme();for(const b in toggleThemeCallbacks)toggleThemeCallbacks[b](a)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent('toggle-theme'))}</script>
<script>(function(){const b='light',a=getPrefTheme(),c=a||b;switchTheme(c)})()</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.black-desk.cn accesskey=h title="RAMBLE&BB (Alt + H)">RAMBLE&BB</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
</ul>
</nav>
</header>
<main class=main>
<article class=first-entry>
<header class=entry-header>
<h2>lambda
</h2>
</header>
<section class=entry-content>
<p>这里整理一些关于c++中的匿名函数的知识.
《C++ primer》上有的内容就不在重述了.这里重点讲一些primer上可能没有的东西.
捕获的时机 primer 向我们介绍到: 有两种捕获变量的方式, 值捕获和引用捕获. 其中:
...
与参数不同,被捕获的变量的值是在lambda创建时拷贝,而不是调用时拷贝
...
如果我们采用引用方式捕获一个变量,就必须确保被引用的对象在lambda执行的时候是存在的.lambda捕获的都是局部变量,这些变量在函数结束后就不复存在了.
...
我们看一段代码:
auto funtionTimesMod1(int mod) { int variableA = mod; auto f = [variableA](int a, int b) { return a % variableA * b % variableA; }; return f; } void test1() { cout &lt;&lt; "---test1---" &lt;&lt; endl; int a = 10, b = 20, c = 7; auto times = funtionTimesMod1(c); cout &lt;&lt; times(a, b) &lt;&lt; endl; } 这里funtionTimesMod1(int mod)返回一个签名为int(int, int)的函数,这个函数计算两个参数相乘对mod取模的结果....</p>
</section>
<footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>July 10, 2022</span></span>
</footer>
<a class=entry-link aria-label="post link to lambda" href=https://blog.black-desk.cn/post/lambda/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>Shadowsocks (一) 主循环
</h2>
</header>
<section class=entry-content>
<p>这里简单分析一下Shadowsocks这个软件的源码.
因为网上一直有声音认为其源码质量不错.刚好最近在学一些服务器编程相关的知识,所以就来简单分析一下它.
同时由于希望能获得一些阅读源码的经验. 这里会简单记录我读源码的心路历程.
目录结构 首先我们来tree一下,惯例,测试相关的文件就省略了
❯ tree . ├── CHANGES ├── CONTRIBUTING.md ├── Dockerfile ├── LICENSE ├── MANIFEST.in ├── README.md ├── README.rst ├── config.json.example ├── debian │ ├── changelog │ ├── compat │ ├── config.json │ ├── control │ ├── copyright │ ├── docs │ ├── init.d │ ├── install │ ├── rules │ ├── shadowsocks.default │ ├── shadowsocks.manpages │ ├── source │ │ └── format │ ├── sslocal.1 │ └── ssserver....</p>
</section>
<footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>July 10, 2022</span></span>
</footer>
<a class=entry-link aria-label="post link to Shadowsocks (一) 主循环" href=https://blog.black-desk.cn/post/shadowsocks1/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>只是为了把 Steam 游戏放到开始屏幕上
</h2>
</header>
<section class=entry-content>
<p>很久以前, 我有一个梦想, 我的开始菜单上能直接固定一些 steam 游戏的磁贴.
然后我苦苦地寻找, 发现了这篇知乎文章, 然后我忍痛剁手, 花了我六块大洋, 买了这个叫 Steam Tiles 的 UWP 应用, 而这一切, 只是噩梦的开始.
初次使用这个 UWP 应用, 它就刷新了我的三观. 一个功能如此简单的应用居然能这么卡.
它需要读你安装 steam 游戏的目录, 然后从里面寻找合适大小的图片来制作磁贴, 也允许用户自定义图片, 可以从 url 下载图片, 可以从本地选取图片文件, 允许用户改变图片的位置, 大小, 以及磁贴的背景色.
听起来很美好, 该自定义的都能自定义. 但是事实上.
我是想破脑袋也想不出来, 为什么他读文件找图片能这么慢, 5个游戏, 他头一次找个图要将近半个小时.
image-20200504214634198 不仅慢, 还有可能会读不出图片来, 比如像下面这样:
image-20200504213156290 而这个时候我唯一找到的解决方法, 就是 TMD 清除掉他对于图片的缓存, 然后再让他找一次.
为什么这么慢呢? 我也不知道. 任务管理器开起来一看:
image-20200504213307798 不占用 CPU, 内存也不大, 那是磁盘读写么?
image-20200504213452252 看起来也不是磁盘读写.那咋回事呢? 天知道....</p>
</section>
<footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>July 10, 2022</span></span>
</footer>
<a class=entry-link aria-label="post link to 只是为了把 Steam 游戏放到开始屏幕上" href=https://blog.black-desk.cn/post/%E5%8F%AA%E6%98%AF%E4%B8%BA%E4%BA%86%E6%8A%8A-steam-%E6%B8%B8%E6%88%8F%E6%94%BE%E5%88%B0%E5%BC%80%E5%A7%8B%E5%B1%8F%E5%B9%95%E4%B8%8A/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>记一个沙雕软件的破解
</h2>
</header>
<section class=entry-content>
<p>本文是一篇日记性质的碎碎念,唠叨和啰嗦在所难免,请见谅.
故事是这样的,我突然想要一个能够在ubuntu上同步Google Drive的软件.我需要这个软件能够监控我磁盘上的文件变化,一旦文件变化了就上传;当然Google Drive上的文件要是发生了变化,也得能够同步到我的磁盘上.
本来以为RClone可以,但是后来发现它只能单向同步,相当于是个备份工具,不能够满足我的要求.
其实我也不希望搞那种很专业的工具,能有谷歌自己在Windows上做的那个"备份与同步" 那点功能,其实就可以了.配置最好也不要太麻烦.
所以我找到了Insync,这是一个支持OneDrive和Google Drive的同步客户端.并不开源,而且售价有点高,要40刀.
我暂时用不到OneDrive,而且这个钱说实话是不想花的(主要还是实在太贵了.
于是我转头又找到了OverGrive,这是一个南非的网站(/组织?)搞的一个Google Drive客户端,也不免费,但是只要5刀了,勉强可以接受.
于是我拿出了我办的浦发双币visa卡.这张卡我办完了以后当时拿来尝试绑Google Play没绑上,所以就一直没用上.不过不用公本费,也没有年金,更没有额度,我只能用支付宝,或者其他银行卡往里面存钱,之后才能消费美元.
这下终于算是派上了用场.
然后迎接我的就是付款失败.里面的钱明明够啊?为啥呢?
打客服电话问了一下,说是这个商户被判定为有可能是投资目标之类的东西,所以被限制交易了.啊这(
那没什么办法,我就淘宝上找了个paypal代付.
结果24h过去了,我仍然没有从我的邮降收到我的激活码邮件,我非常确定没有在垃圾桶里.
当然这个软件是有试用版的,有14天的试用期,可能是开发者认为只要14天以内发激活码就行了么???
不过,由于这个软件存在一些启动过程中的问题,所以我稍微研究了一下它,发现这是一个 python写的东西,于是我用uncompyle6,给它反编译了一下,看到了源码.
不过反编译出来的源码并不能正常运行,存在一些问题,应该是反编译的时候控制流识别出错了.
但是我却因此能够看到它的激活流程:
def on_activation_button(widget): global licenseDisplay global splashProgressBar global splashWindow if 'ProgressBar' in str(splashGrid.get_child_at(0, 4)): Gtk.Container.remove(splashGrid, splashProgressBar) splashGrid.attach(splashEntry, 0, 4, 2, 1) splashEntry.set_tooltip_text(_('Copy and Paste your') + ' ' + appDisplayName + ' ' + _('Activation code')) splashEntry.set_placeholder_text(_('Enter Activation Code')) splashLabel3....</p>
</section>
<footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>July 10, 2022</span></span>
</footer>
<a class=entry-link aria-label="post link to 记一个沙雕软件的破解" href=https://blog.black-desk.cn/post/overgrive/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>麻将图片生成器
</h2>
</header>
<section class=entry-content>
<p>这两天由于拿到了一个麻将图包,运用了一些编译原理课上学的知识,动手实现了一个简单的麻将图片生成器.
项目地址在这里,同时也在自己的服务器上部署了一个demo.
这里简单聊聊这个小工具.
名字 Mahjong,是麻将这个游戏的一种英文表示方法,由于雀魂叫majsoul,这里就只用到j为止,加上图片image的im,就成了mahjim, 这个命名可以说是很没有新意了.
思路 基础 首先要解决的就是如何用字符串表示麻将的问题.天凤有比较完整的记牌方式:
m=萬子, p=筒子, s=索子, z=字牌, 0=赤 一般形=４面子１雀頭 / 標準形=一般形＋七対形＋国士形 ツモはその時点で使用していない牌をランダムに選択します 有効牌をクリックすると打牌後にその牌をツモ牌として表示します (n*3+2)枚で開始：(n*3+2)枚目をツモ牌として表示 (n*3+1)枚で開始：ツモはページのロード時に毎回変化 和了役の判定はありません 暗槓はできません 但是这套规则只是天风用来计算牌效的小程序使用的,并不能用来表示由于吃碰杠出现的牌横置情况.
而且需要注意的是,天凤使用的这一套标记法,面对字牌并不那么方便,1~7z分别代表的是东南西北白发中,由于日麻和国内的三元牌顺序并不同,所以需要一定的适应.
以这个为基础,我们可以考虑在牌前面加上前缀来表示牌的情况,实际上对于输出图片这个需求而言,任何一张麻将一共就4种状态,正常竖置,横置,横置加杠,翻面.其中翻面我们可以考虑直接输出一张背面的图片,所以可以看作是一种特殊的牌.如果采用_来表示牌的横置,^表示牌加杠,那么就形成了我采取的这种方法来表示一张正常的牌:
pre+num+class 其中pre表示一个前缀,可以是_或者^,也可以没有,用来表示牌的摆放方式.num表示牌的点数,class用来表示牌的种类,可以是p,s,m,z.
但是每个牌都这么写就太烦了,我们需要一些简写的方式.
很容易想到的就是class可以合并,比如123s应该和1s2s3s是等价的,这样也不会有什么歧义.
字牌 可以看出,这个记牌方式对于字牌来说非常不友好,而且按照上面的想法进行了缩写之后,国标的春夏秋冬梅兰竹菊加进来以后,字牌的总数会超过10种.那么这样的缩写就会有问题了.
简单的解决方式就是直接用汉字来输入字牌,那么这样的话,类似中中中,白白白这种经常出现的组合又显得很不方便.所以我们也可以简单的想到一个这样的缩写:3中=中中中,仔细想想就会发现这个缩写和之前的数字牌表示方式是不冲突的.
风格 由于图包中的麻将区分国标和日麻,我们还需要一个额外的设置,来区分cn和jp,简单起见,我们就直接在整个字符串的开头放上一个cn|或者jp|来区分就可以了.
文法 我们做了这样的设计之后,基本整理一下就可以得出文法了:
input -> style + "|" + majs | majs // 旧 input -> majs style -> "cn" | "jp" 国标/日麻 // 旧 majs -> group + majs | empty 描述麻将牌的字符串 group -> ps + class | p + Z 按照牌的种类将牌分组, 比如 "123s456w3中" 有3个group, "123s" "456w" "3中" F -> "东" | "南" | "西" | "北" | "白" | "发" | "中" | "+" | ....</p>
</section>
<footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>July 10, 2022</span></span>
</footer>
<a class=entry-link aria-label="post link to 麻将图片生成器" href=https://blog.black-desk.cn/post/mahjim/></a>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://blog.black-desk.cn>RAMBLE&BB</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span>
<span style=display:inline-block;margin-left:1em>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdnjs.cloudflare.com/ajax/libs/Han/3.3.0/han.min.js></script>
<script>(function(){const b=''=='1';if(b)return;let a=document.getElementById("theme-toggle");a.removeEventListener('click',toggleThemeListener),a.addEventListener('click',toggleThemeListener)})()</script>
<script>(function(){let a=document.getElementById('menu');a&&(a.scrollLeft=localStorage.getItem("menu-scroll-position"),a.onscroll=function(){localStorage.setItem("menu-scroll-position",a.scrollLeft)});const b=''=='1',c=''=='1';if(window.matchMedia('(prefers-reduced-motion: reduce)').matches||b||c)return;document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})})()</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>if(window.scrollListeners)for(const a of scrollListeners)window.removeEventListener('scroll',a);window.scrollListeners=[]</script>
<script src=/js/medium-zoom.min.js data-no-instant></script>
</body>
</html>